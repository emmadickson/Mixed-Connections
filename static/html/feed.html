<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="../js/jquery-3.2.1.min.js"></script>

    <link href="https://fonts.googleapis.com/css?family=Raleway+Dots" rel="stylesheet">
    <style>
     @import url('https://fonts.googleapis.com/css?family=Raleway+Dots');
     body{
        overflow: hidden;
        background: black;
        border:0;
        margin:0;
      }
      #canvas1{
        width: 100vw;
        height: 100vh;
        font-family: 'Raleway Dots', cursive;
        z-index:2;
      }

      @font-face {
          font-family: 'Raleway', sans-serif;
          font-weight: 600;

      }
      form{

        resize:both;
      }
      form{
      resize:both;
      z-index:1;
      position: absolute;
      left: 60%;
      top: 70%;
      transform: translate(-50%,-50%);
      }
      div{
      z-index:1;
      color:white;
      font-family: 'Raleway Dots', cursive;;
      font-weight: 600;
      font-size: 250px;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%,-50%);
      }
      button{
        z-index:1;
      }
    </style>
  </head>

  <body id="body">
    <div>What did You miss?</div>
    <canvas id="canvas1"></canvas>
    <form action="/add" method="post">
    <input type="text" name="text" id="input"></input>
    <input id="submit" type="submit" value="Submit">
  </form>
  </body>

  <script>
  $('submit').on('click', function(e) {
        var text = document.getElementById('input').value
        document.getElementById('input').value = "Why thank you"
        var xhr = new XMLHttpRequest();
        xhr.open("POST", '/add', true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify({
            post: text
        }));
    }
  });
  $('textarea').on('keydown', function(e) {
      if (e.which == 13) {
        var text = document.getElementById('input').value
        document.getElementById('input').value = "Why thank you"
        var xhr = new XMLHttpRequest();
        xhr.open("POST", '/feed', true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify({
            post: text
        }));
    }
  });
  var circles = [],
  canvas = document.getElementById("canvas1"),
  context = canvas.getContext("2d"),

  // SETTINGS
  opacity = 0.6,
  startColorR = 0
  startColorG = 0
  startColorB = 0
  colors = []
  while(startColorR+startColorG+startColorB < 60){
    startColorR = Math.floor((Math.random() * 125) + 1);
    startColorG = Math.floor((Math.random() * 125) + 1);
    startColorB = Math.floor((Math.random() * 125) + 1);
  }
  color1 = "rgba("+startColorR+", "+startColorG+", "+startColorB+")"
  colors.push(color1)

  color2m = (Math.random() * 1.5) + 0.2

  startColorR = startColorR * color2m
  startColorG = startColorG * color2m
  startColorB = startColorB * color2m
  while(startColorR+startColorG+startColorB < 60){
    startColorR = Math.floor((Math.random() * 125) + 1);
    startColorG = Math.floor((Math.random() * 125) + 1);
    startColorB = Math.floor((Math.random() * 125) + 1);
  }
  color2 =  "rgba("+startColorR + ", " + startColorG + ", " + startColorB+ "," + opacity + ")"            // the opacity of the circles 0 to 1
  colors.push(color2)

  color3m = (Math.random() * 1.5) + 0.2

  startColorR = startColorR * color3m
  startColorG = startColorG * color3m
  startColorB = startColorB * color3m
  while(startColorR+startColorG+startColorB < 60){
    startColorR = Math.floor((Math.random() * 125) + 1);
    startColorG = Math.floor((Math.random() * 125) + 1);
    startColorB = Math.floor((Math.random() * 125) + 1);
  }
  color3 =  "rgba("+startColorR + ", " + startColorG + ", " + startColorB+ "," + opacity + ")"            // the opacity of the circles 0 to 1
  colors.push(color3)


  startColorR = startColorR * (Math.random() * 1.5) + 0.2
  startColorG = startColorG * (Math.random() * 1.5) + 0.2
  startColorB = startColorB * (Math.random() * 1.5) + 0.2
  while(startColorR+startColorG+startColorB < 60){
    startColorR = Math.floor((Math.random() * 125) + 1);
    startColorG = Math.floor((Math.random() * 125) + 1);
    startColorB = Math.floor((Math.random() * 125) + 1);
  }
  color4 =  "rgba("+startColorR + ", " + startColorG + ", " + startColorB+ "," + opacity + ")"            // the opacity of the circles 0 to 1
  colors.push(color4)

  startColorR = startColorR * (Math.random() * 1.5) + 0.2
  startColorG = startColorG * (Math.random() * 1.5) + 0.2
  startColorB = startColorB * (Math.random() * 1.5) + 0.2
  while(startColorR+startColorG+startColorB < 60){
    startColorR = Math.floor((Math.random() * 125) + 1);
    startColorG = Math.floor((Math.random() * 125) + 1);
    startColorB = Math.floor((Math.random() * 125) + 1);
  }
  color5 =  "rgba("+startColorR + ", " + startColorG + ", " + startColorB+ "," + opacity + ")"            // the opacity of the circles 0 to 1
  colors.push(color5)

  var body = document.getElementById('body')
  body.style.backgroundColor=colors[Math.floor((Math.random() * 4) + 0)]
  minSize = 1,                                        // the minimum size of the circles in px
  maxSize = 70,                                       // the maximum size of the circles in px
  numCircles = 500,
  minSpeed = -2,                                     // the minimum speed, recommended: -maxspeed
  maxSpeed = 2,                                      // the maximum speed of the circles
  expandState = true;                                // the direction of expansion

function buildArray() {
  'use strict';

  for (var i =0; i < numCircles ; i++){
      var color = Math.floor(Math.random() * (colors.length - 1 + 1)) + 1,
          left = Math.floor(Math.random() * (canvas.width - 0 + 1)) + 0,
          top = Math.floor(Math.random() * (canvas.height - 0 + 1)) + 0,
          size = Math.floor(Math.random() * (maxSize - minSize + 1)) + minSize,
          leftSpeed = (Math.floor(Math.random() * (maxSpeed - minSpeed + 1)) + minSpeed)/10,
          topSpeed = (Math.floor(Math.random() * (maxSpeed - minSpeed + 1)) + minSpeed)/10,
          expandState = expandState;

          while(leftSpeed == 0 || topSpeed == 0){
              leftSpeed = (Math.floor(Math.random() * (maxSpeed - minSpeed + 1)) + minSpeed)/10,
              topSpeed = (Math.floor(Math.random() * (maxSpeed - minSpeed + 1)) + minSpeed)/10;
          }
      var circle = {color:color, left:left, top:top, size:size, leftSpeed:leftSpeed, topSpeed:topSpeed, expandState:expandState };
      circles.push(circle);
  }
}

function build(){
  'use strict';

  for(var h = 0; h < circles.length; h++){
      var curCircle = circles[h];
      context.fillStyle = colors[curCircle.color-1];
      context.beginPath();
      if(curCircle.left > canvas.width+curCircle.size){
          curCircle.left = 0-curCircle.size;
          context.arc(curCircle.left, curCircle.top, curCircle.size, 0, 2 * Math.PI, false);
      }else if(curCircle.left < 0-curCircle.size){
          curCircle.left = canvas.width+curCircle.size;
          context.arc(curCircle.left, curCircle.top, curCircle.size, 0, 2 * Math.PI, false);
      }else{
          curCircle.left = curCircle.left+curCircle.leftSpeed;
          context.arc(curCircle.left, curCircle.top, curCircle.size, 0, 2 * Math.PI, false);
      }

      if(curCircle.top > canvas.height+curCircle.size){
          curCircle.top = 0-curCircle.size;
          context.arc(curCircle.left, curCircle.top, curCircle.size, 0, 2 * Math.PI, false);

      }else if(curCircle.top < 0-curCircle.size){
          curCircle.top = canvas.height+curCircle.size;
          context.arc(curCircle.left, curCircle.top, curCircle.size, 0, 2 * Math.PI, false);
      }else{
          curCircle.top = curCircle.top+curCircle.topSpeed;
          if(curCircle.size != maxSize && curCircle.size != minSize && curCircle.expandState == false){
            curCircle.size = curCircle.size-0.1;
          }
          else if(curCircle.size != maxSize && curCircle.size != minSize && curCircle.expandState == true){
            curCircle.size = curCircle.size+0.1;
          }
          else if(curCircle.size == maxSize && curCircle.expandState == true){
            curCircle.expandState = false;
            curCircle.size = curCircle.size-0.1;
          }
          else if(curCircle.size == minSize && curCircle.expandState == false){
            curCircle.expandState = true;
            curCircle.size = curCircle.size+0.1;
          }
          context.arc(curCircle.left, curCircle.top, curCircle.size, 0, 2 * Math.PI, false);
      }

      context.closePath();
      context.fill();
      context.ellipse;
  }
}


var xVal = 0;

window.requestAnimFrame = (function (callback) {
  'use strict';
  return window.requestAnimationFrame ||
  window.webkitRequestAnimationFrame ||
  window.mozRequestAnimationFrame ||
  window.oRequestAnimationFrame ||
  window.msRequestAnimationFrame ||
  function (callback) {
      window.setTimeout(callback, 1000);
  };
})();

function animate() {
  'use strict';
  var canvas = document.getElementById("canvas1"),
      context = canvas.getContext("2d");

  // clear the canvas
  context.clearRect(0, 0, canvas.width, canvas.height);


  // draw the next frame
  xVal++;
  build();


  //console.log("Prep: animate ==> requestAnimFrame");
  // request a new frame
  requestAnimFrame(function () {
      animate();
  });
}
window.onload = function () {
  'use strict';
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  buildArray();
  animate();
};


window.onresize = function () {
  'use strict';
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  //buildArray();
  animate();
};
  </script>
</html>
