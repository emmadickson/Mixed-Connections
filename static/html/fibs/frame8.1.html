<!DOCTYPE html>
<html>
  <head>
    <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <meta charset="UTF-8">
    <style>
    body{
      background: black;
      position: relative;
      color:white;
    }
    div{
      bottom: 0px;
      right:0px;
      font-size: 8px;
      font-family: 'Press Start 2P', cursive;
      color: #00FF00;
    }
    </style>
  </head>

  <body>

  </body>
  <script type="text/javascript" src="js/util.js"></script>
  <script>

      jQuery.get('/raw_db', function(data) {

       var entries = JSON.stringify(data)
       entries = entries.split("\\")
       entries = entries.slice(1,entries.length)
        // 3. Set up Arrays to recieve titles and posts from the txt file.
        posts = []
        // 4. posts the document up into lines and from individiaul lines into titles and posts
        var spans = []
        for (var i = 0; i < entries.length; i++){
           if (entries[i].length > 10){
            var limbs = entries[i].split("***");
            post = limbs[1]
            beginning = post.slice(0,3)
            if (beginning.indexOf("I ") !== -1){
              var result = post.match( /[^\.!\?]+[\.!\?]+/g );
              if (result != null){
                spans.push(result[0])
              }
            }
          }
        }

        var body = document.getElementsByTagName('body')[0]
        var i = 0;
        var random_words = []
        var k = 0

        fillers = ["an", "this.", "this", "but", "I", "of", "to", "and", "in", "at", "the", "", "that", "on", "a", "if"]

        while(random_words.length < spans.length){
          sentence = spans[k].split(' ');
          var possibilities = []

          for (var t = 0; t < sentence.length; t++){
            word = sentence[t]
            if (fillers.indexOf(word) == -1){
              possibilities.push(word)
            }
          }
          shuffle(possibilities);
          var r = Math.floor(Math.random() * possibilities.length);
          var word = possibilities[r]
          var index = sentence.indexOf(word);
          word = possibilities[r] + "*?*"
          sentence[index] = word
          random_words.push(sentence)
          k++
        }

        spans = spans.join(' ')
        spans = spans.slice(1,spans.length-1)

        setInterval(function(){
          var body = document.getElementsByTagName('body')[0]
          if (i >= spans.length){
            i = 0;
          }
          else{
            if (spans[i] == "I"){
              var br = document.createElement('br')
              body.appendChild(br)
              var div = document.createElement('div')
              body.appendChild(div)
            }
            var div = document.getElementsByTagName('div')
            div = div[div.length-1]

            div.textContent = div.textContent.slice(0, div.textContent.length-1)
            div.textContent = div.textContent + spans[i]
            div.textContent = div.textContent + "_"
          }
          i++;
        }, 100);
    })
  </script>
</html>
